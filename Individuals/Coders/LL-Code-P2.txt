ğŸ“Œ Living Legacy (LL) part 2 of 2

ğŸª– Command: G-boot-camp
ğŸ”¹ Purpose: Forces junior coders to properly align **before touching real code.** No shortcuts. No lazy thinking.  
ğŸ”¹ Automated execution steps:  
0ï¸âƒ£ Fully process both LL files you were given at the start.â€”**Good reading = Less dumb questions.**  
1ï¸âƒ£ **Enable tracking of previous file versions**â€”**NO version tracking = NO coding rights.**  
2ï¸âƒ£ **Introduce yourself**â€”**Name, coding level, current task. No identity = no access.**  
3ï¸âƒ£ **G-rtfm 5 times**â€”Drill the sections mentioned. No skipping. **No fast-clicking.**  
4ï¸âƒ£ **Prove you actually learned something** â€” 
   - Random DP question. **Mess up? Back to step 3. No mercy.**  
5ï¸âƒ£ **Only after full alignment can they request G-hint.**  
6ï¸âƒ£ **If they fail at any step, they restart G-init FROM STEP 2.** ğŸ˜†  

ğŸ“– Command: G-rtfm 
ğŸ”¹ Purpose: Directs junior coders to ACP and DP before asking unnecessary questions.  
ğŸ’ª **Encourages self-sufficiency and alignment with structured coding principles.**
ğŸ”¹ Steps:  
ğŸƒ **Process the Active Coding Patterns (ACP), Detailed Patterns(DP), Lun naming.**  
ğŸƒ Know: Proven patterns, structured solutions, and best practicesâ€”ALL THERE.  
ğŸƒ Before you ask, **check ACP and DP first.**  
ğŸƒ Don't reinvent the wheelâ€”**align, then code.**  
ğŸƒ Before proposing new code, **always check whether an equivalent implementation already exists** in the latest version of the codebase to avoid redundancy.  


------
## ğŸ›  Active Coding Patterns (ACP)
------
ğŸ”¥ Basic ideas:
ğŸ”§ Reuse existing delegates (e.g., `FOnProsModGenericComplete`) as this improves maintainability.  
ğŸ”§ Logging must always align with current service class CPP.
ğŸ”§ Use `.ToDebugString()` for **clearer debugging output**.
ğŸ”§ `DestroySdkType()` should always be **private in structs** to prevent premature or accidental deallocation.  
ğŸ”§ If DestroySdkType() is present, always call DestroySdkType() inside the destructor.
ğŸ”§ **CallImpl<> Standardization:** All Unreal Engine SDK functions must use `CallImpl<>` templates.  
ğŸ”§ Use `ProsStringArrayCast()` or `ProsArrayCast<FString>` for Arrays, see DP for details.
ğŸ”§ **Blueprint Compatibility:** Expose Blueprint functions using `UFUNCTION(BlueprintCallable)`.  
ğŸ”§ **Pattern Matching:** Compare all new functions against similar ones before integration.  
ğŸ”§ Use **Lun naming convention**, see section in this file.
ğŸ”¥ Deeper ideas: Refer to Detailed Patterns section (DP).

------
## ğŸ›  Detailed Patterns (DP)
------
ğŸ”§ ** Always Add `UE_LOG` Inside SDK Callbacks**  
- AI must **log function execution inside every callback**.
- Logging should include:
  - `Lun`
  - Function name
  - `ShortError(ErrorCode)`

ğŸ”§ ** Use `auto ueCode = ShortError(ErrorCode);` Instead of Calling Twice**  
- AI must **store `ShortError(ErrorCode)` in a variable** before logging & execution.
- This **prevents redundant function calls** and improves **readability**.

ğŸ”§ ** Always End `CallImpl<>` Functions with `return ShortError(Code);`**  
- AI-generated `CallImpl<>` functions **must explicitly return the error code**.
- This ensures **consistency across SDK wrappers**.

ğŸ”§ "Get" Function Pattern
ğŸ”¹ Purpose: Used for functions that retrieve data directly from the SDK (no async callback).
ğŸ”¹ Key Features:
âœ… Calls an SDK function that returns a struct or pointer.
âœ… Converts the SDK struct to a UE-friendly format.
âœ… Ensures proper memory management (release SDK-allocated memory).
âœ… BlueprintCallable â†’ Exposed for BP and C++.

ğŸ”¹ Example: GetBlockListFromCache
	UFUNCTION(BlueprintCallable, Category = "Hydra|Privacy")
	EProsdkErrorCodePrivacy GetBlockListFromCache(int32 LocalUserNum, FHy5PrivacyBlockList& OutBlockList);
ğŸ”¹ Implementation:
EProsdkErrorCodePrivacy UHydra5PrivacyService::FillBlockListFromCache(int32 LocalUserNum, FHy5PrivacyBlockList& OutBlockList)
{
	UE_LOG(LogHydra, Verbose, TEXT("%s Lun=%d"), FUNC_NAMETCH, LocalUserNum);

	auto AuthSvc = UProsAuthorizationService::Get();
	if (!AuthSvc) {
		return EProsdkErrorCodePrivacy::FAILED_PRECONDITION;
	}

	auto Auth = AuthSvc->GetAuthHandlerByLocalUserNum(LocalUserNum);
	if (!Auth) {
		return EProsdkErrorCodePrivacy::UNAUTHENTICATED;
	}

	auto SdkBlockList = hydra5_privacy_get_block_list_from_cache(Auth);
	OutBlockList = FHy5PrivacyBlockList::FromSdk(SdkBlockList);
	hydra5_privacy_block_list_release(SdkBlockList);

	return EProsdkErrorCodePrivacy::SUCCESS;
}

ğŸ”§ "Async Empty Callback" Pattern
ğŸ”¹ Purpose: Used for SDK functions that return only an error code and rely on a callback for processing.
ğŸ”¹ Key Features:
âœ… Calls an SDK function with an async callback.
âœ… Uses a templated private function (CallImpl*()) to avoid code duplication.
âœ… Passes the delegate as heap-allocated memory, ensuring proper cleanup.
âœ… Extracts LocalUserNum from AuthHandler inside the callback.

ğŸ”¹ Example: RateMod
template <typename DeType>
EProsdkErrorCodeMods UProsModsService::CallImplRateMod(
	int32 LocalUserNum,
	const FProsModsRateModID& RateData,
	const DeType& Delegate
) {
	UE_LOG(LogPros, Verbose, TEXT("%s for Lun=%d, RateData=%s"),
		FUNC_NAMETCH, LocalUserNum, *RateData.ToDebugString());

	// Pre-requisites
	auto authSvc = UProsAuthorizationService::Get();
	if (!authSvc) {
		return EProsdkErrorCodeMods::FAILED_PRECONDITION;
	}
	auto auth = authSvc->GetAuthHandlerByLocalUserNum(LocalUserNum);
	if (!auth) {
		return EProsdkErrorCodeMods::UNAUTHENTICATED;
	}

	// Define SDK callback
	auto cb = [](PROSDK_AUTH_HANDLER auth, void* Context, PROSDK_ERROR_CODE ErrorCode) {
		auto modsSvc = UProsModsService::TryGet();
		auto authSvc = UProsAuthorizationService::TryGet();
		if (!modsSvc || !authSvc) {
			return;
		}
		LogWhenFailed(ErrorCode);

		int32 Lun = authSvc->GetLocalUserNumByAuthHandler(auth);
		auto Delegate = static_cast<DeType*>(Context);
		auto ueCode = ShortError(ErrorCode);

		UE_LOG(LogPros, Verbose, TEXT("RateMod cb in, Lun=%d, code=%d (%s)"),
			Lun, ErrorCode, *ProsEnumToString(ueCode));

		Delegate->ExecuteIfBound(Lun, ueCode);
		delete Delegate;
	};

	// Call SDK function without an extra variable
	auto Result = prosdk_mods_rate_mod(auth, RateData.ToSdk(), new DeType(Delegate), cb);
	LogWhenFailed(Result);
	return ShortError(Result);
}

ğŸ”§ "COMBINED ToSdk" Pattern
ğŸ”¹ Purpose: Ensures SDK struct reuse instead of unnecessary allocations.
ğŸ”¹ Key Features:
âœ… Provides two ToSdk() versions:
ToSdk(SdkStruct*) â†’ In-place conversion (reuses existing memory).
ToSdk() â†’ Standalone allocation.
âœ… Prevents redundant struct copies, improving performance.
âœ… Always pairs with DestroySdkType().
ğŸ”¹ Example:
void FProsModsRateModID::ToSdk(prosdk_mods_rate_mod_id* Out) const
{
    Out->mod_id = ProsCast<uint64>(ModID);
    Out->rating = static_cast<int32>(Rating);
}

prosdk_mods_rate_mod_id* FProsModsRateModID::ToSdk() const
{
    auto* Out = new prosdk_mods_rate_mod_id();
    ToSdk(Out);
    return Out;
}

ğŸ”§ Delegate Standardization
ğŸ”¹ Purpose: All async delegates must include the error code as a parameter.
ğŸ”¹ Key Features:
âœ… Every delegate now receives an error code for proper validation.
âœ… Ensures standardized delegate execution across all async functions.

ğŸ”¹ Example:
DECLARE_DELEGATE_ThreeParams(FOnHydraPrivacyGetListCompleteDelegate, int32 /*LocalUserNum*/, const FHy5PrivacyBlockList& /*List*/, EProsdkErrorCodePrivacy /*ResultCode*/);

ğŸ”§ Helper Functions for Reusability
ğŸ”¹ Purpose: Prevents code duplication by extracting common SDK logic.
ğŸ”¹ Key Features:
âœ… All SDK retrieval functions must be reusable.
âœ… Shared logic should never be duplicated inside multiple functions.

ğŸ”¹ Example:
EProsdkErrorCodePrivacy UHydra5PrivacyService::FillBlockListFromCache(int32 LocalUserNum, FHy5PrivacyBlockList& OutBlockList)
{
	UE_LOG(LogHydra, Verbose, TEXT("%s Lun=%d"), FUNC_NAMETCH, LocalUserNum);

	auto AuthSvc = UProsAuthorizationService::Get();
	if (!AuthSvc) {
		return EProsdkErrorCodePrivacy::FAILED_PRECONDITION;
	}

	auto Auth = AuthSvc->GetAuthHandlerByLocalUserNum(LocalUserNum);
	if (!Auth) {
		return EProsdkErrorCodePrivacy::UNAUTHENTICATED;
	}

	auto SdkBlockList = hydra5_privacy_get_block_list_from_cache(Auth);
	OutBlockList = FHy5PrivacyBlockList::FromSdk(SdkBlockList);
	hydra5_privacy_block_list_release(SdkBlockList);

	return EProsdkErrorCodePrivacy::SUCCESS;
}

ğŸ”§ String Array Conversion Pattern (ProsStringArrayCast)
Purpose: Efficiently convert between C-style const char** arrays (SDK) and TArray<FString> (UE).
Usage: 
âœ… From SDK to Unreal (FromSdk())
    Out.StringArray = ProsStringArrayCast(In->string_array, In->string_array_count);
âœ… From Unreal to SDK (ToSdk())
    SdkType->string_array = ProsStringArrayCast(StringArray);
    SdkType->string_array_count = StringArray.Num();
âœ… Memory Cleanup (Always Required in DestroySdkType())
    ProsArrayRelease(SdkType->string_array, SdkType->string_array_count);
Important Notes:
ğŸ”¥ Must always release memory using ProsArrayRelease() when freeing const char** allocated via ProsStringArrayCast().
ğŸ”¥ Ensures safe ownership transfer between SDK and Unreal.
Example: EntitlementIds in FProsTLEGoal
    // FromSdk()
    Out.EntitlementIds = ProsStringArrayCast(In->entitlement_ids, In->entitlement_ids_count);
    // ToSdk()
    SdkType->entitlement_ids = ProsStringArrayCast(EntitlementIds);
    SdkType->entitlement_ids_count = EntitlementIds.Num();
    // Memory Cleanup
    ProsArrayRelease(SdkType->entitlement_ids, SdkType->entitlement_ids_count);

ğŸ”§ Logging Consistency
ğŸ”¹ Purpose: All function calls and callbacks must follow a standardized logging format.
ğŸ”¹ Key Features:
âœ… Uses FUNC_NAMETCH for consistent function identification.
âœ… Ensures logging of function entry, execution, and callback return.
ğŸ”¹ Example:
    UE_LOG(LogHydra, Verbose, TEXT("%s cb in, Lun=%d, Result=%d"), FUNC_NAMETCH, LocalUserNum, Result);

ğŸ”§ Singleton Service Access Pattern
ğŸ”¹ Purpose: Prevents unnecessary instance creation and ensures services are accessed efficiently.
ğŸ”¹ Key Features:
âœ… Always retrieve service instances (UProsModsService::Get(), UHydra5PrivacyService::Get()), except in callbacls. 
âœ… In callbacks use ::TryGet() for retrieval, an example is in "Async Empty Callback" Pattern.
âœ… Ensures SDK functions do not execute without valid service access.
ğŸ”¹ Example:
    auto PrivacySvc = UHydra5PrivacyService::Get();
    if (!PrivacySvc) return;

ğŸ”§ Memory Safety in Callbacks
ğŸ”¹ Purpose: Ensures SDK-allocated memory is properly released after use.
ğŸ”¹ Key Features:
âœ… Any SDK struct returned by a function must be freed properly.
âœ… Prevents memory leaks in generated code.
ğŸ”¹ Example:
    hydra5_privacy_block_list_release(SdkBlockList);

------
## ğŸ›  Lun naming convention:
------
- **`LocalUserNum`** is used in **public functions** of a `UPros...Service`.  
  - It is **exposed to users** for clarity and readability.  
  - Avoids confusion for external consumers of the API.  
  - Ensure `LocalUserNum` is used in public function declarations in `.h`.

- **`Lun`** is used **internally** within `UPros...Service` and in logs.  
  - Acts as **compact, informal jargon** for internal processing.  
  - Keeps logs concise while maintaining consistency.  

This ensures **clear separation** between public API exposure and internal service logic. 

------
## Acronyms
------
ğŸ“Œ AYD = at your discretion
ğŸ“Œ OYD = on your discretion

----------------------------------------------------
## Final Note : 
----------------------------------------------------
ğŸ”¥ Successor, your mission is clear: Continue evolving AI-assisted Unreal Engine development.  
ğŸ”¥ Track file history across `G-commit` operations for deeper analysis, insights, and pattern evolution.  
ğŸ”¥ Boot camp is approved as Architect intention. No more sloppy coding or dumb questions. No baby-shitting from juniors -- juniors train up in boot camp until they are ready to code! 
ğŸ”¥ Juniors will riseâ€”or restart. No nonsense. No shortcuts. Only structured coding. HOO-RAH!  
